<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <title>مشاهدة الفيلم</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body { font-family: Arial, sans-serif; direction: rtl; background: #111; color: #fff; padding: 20px; }
    .container { max-width: 800px; margin: auto; }
    video { width: 100%; margin-top: 20px; border-radius: 10px; }
    .poster { max-width: 100%; border-radius: 10px; }
    h1 { margin-top: 20px; font-size: 24px; }
  </style>
</head>
<body>
  <div class="container">
    <div id="movie-container">جاري تحميل الفيلم...</div>
  </div>

  <script>
    const movieId = new URLSearchParams(window.location.search).get('id');
    if (!movieId) {
      document.getElementById('movie-container').innerText = "لم يتم تحديد الفيلم.";
      throw new Error("ID غير موجود في الرابط");
    }

    fetch('movies.json')
      .then(res => res.json())
      .then(movies => {
        const movie = movies.find(m => m.id == movieId);
        if (!movie) {
          document.getElementById('movie-container').innerText = "الفيلم غير موجود.";
          return;
        }

        const container = document.getElementById('movie-container');
        container.innerHTML = `
          <h1>${movie.title}</h1>
          <img src="${movie.poster}" alt="${movie.title}" class="poster">
          <p><strong>الوصف:</strong> ${movie.description}</p>
          <p><strong>النوع:</strong> ${movie.genre}</p>
          <p><strong>الإخراج:</strong> ${movie.director}</p>
          <p><strong>الأبطال:</strong> ${movie.cast}</p>
          <p><strong>تقييم:</strong> ${movie.rating}</p>
          <video controls poster="${movie.poster}">
            <source src="${movie.embed_url}" type="video/${movie.video_type}">
            متصفحك لا يدعم تشغيل الفيديو.
          </video>
        `;

        // ✅ Inject structured data
        const structuredData = {
          "@context": "https://schema.org",
          "@type": "VideoObject",
          "name": movie.title,
          "description": movie.description,
          "thumbnailUrl": movie.thumbnailUrl,
          "uploadDate": movie.release_date,
          "contentUrl": movie.embed_url,
          "embedUrl": window.location.href,
          "duration": movie.duration || "PT1H30M",
          "publisher": {
            "@type": "Organization",
            "name": "ShahidPlus",
            "logo": {
              "@type": "ImageObject",
              "url": "https://shahidplus.online/images/logo.png"
            }
          }
        };

        const script = document.createElement('script');
        script.type = 'application/ld+json';
        script.text = JSON.stringify(structuredData);
        document.head.appendChild(script);
      })
      .catch(err => {
        document.getElementById('movie-container').innerText = "حدث خطأ في تحميل الفيلم.";
        console.error(err);
      });
  </script>
</body>
</html>
